<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Il tuo regalo</title>
  <style>
    :root{
      --brand:#c94f2d;
      --brand-dark:#a83f23;
      --bg1:#f7e7d4;
      --bg2:#f5c1a5;
      --paper:#fffaf5;
      --card:#ffffff;
      --ok:#2a7a35;
      --warn:#d9534f;
      --track:#f1e4db;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Poppins", Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color:#333;
      text-align:center;
    }

/* Intro */
header{
  min-height: 100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding: 0 20px;

  /* Sfondo con immagine */
  background: url("sfondo.jpeg") center center / cover no-repeat;
  position: relative;
}


/* Oscuramento per rendere leggibile il testo */
header::before{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.35); /* scurisce un po‚Äô l‚Äôimmagine */
}

/* Manteniamo il contenuto sopra lo sfondo */
header .wrap{
  display:flex;
  flex-direction:column;
  gap:18px;
  align-items:center;

  position:relative;
  z-index:1;
}

    header .hero{
      font-size: clamp(2rem, 4vw + 1rem, 3rem);
      font-weight:800;
      line-height:1.1;
      background:#ffffffcc;
      padding:28px 22px;
      border-radius:28px;
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
    }
    .cta{
      padding: 12px 22px;
      font-size: 1.05rem;
      background: var(--brand);
      color: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition:.25s;
      box-shadow: 0 8px 18px rgba(201,79,45,.35);
    }
    .cta:hover{ background: var(--brand-dark); transform: translateY(-1px); }

    /* Sezioni principali (quiz/regalo) */
    section{
      padding: 48px 20px 80px;
      background: var(--paper);
      border-top-left-radius: 40px;
      border-top-right-radius: 40px;
      margin-top:-30px;
      box-shadow: 0 -5px 18px rgba(0,0,0,.12);

      display:none;
      opacity:0;
      transform: translateY(10px);
      transition: opacity .4s ease, transform .4s ease;
    }
    section.show{ display:block; opacity:1; transform:none; }

    /* ===== Progress Bar ===== */
    .progress-wrap{
      max-width: 740px;
      margin: 0 auto 14px;
      display:flex; flex-direction:column; align-items:center; gap:8px;
    }
    .progress-label{ font-weight:700; color:#555; font-size:.98rem; }
    .progress{
      position:relative;
      width: min(740px, 92vw);
      height: 16px;
      background: var(--track);
      border-radius: 999px;
      box-shadow: inset 0 2px 6px rgba(0,0,0,.06);
      overflow: hidden;
    }
    .progress .bar{
      position:absolute; inset:0 auto 0 0;
      width: 0%;
      background: linear-gradient(90deg, #ffb199, #ff7e67, #ff5f46);
      border-radius:999px;
      transition: width .35s ease;
    }
    .progress .gift{ position:absolute; right:-2px; top:50%; transform: translateY(-60%); font-size:20px; }

    h2{ color:var(--brand); margin: 10px 0 10px; font-size: clamp(1.3rem, 1.1rem + 1vw, 2rem); }
    .subtitle{ color:#555; margin-bottom:22px; }
    .quiz{ max-width:740px; margin:0 auto; text-align:left; }

    .question{
      background: var(--card);
      padding: 18px 18px 14px;
      margin: 16px 0;
      border-radius: 16px;
      box-shadow: 0 6px 14px rgba(0,0,0,.08);
      border:1px solid #0000000f;

      display:none; opacity:0; transform: translateY(6px);
      transition: opacity .25s ease, transform .25s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .question.active{ display:block; opacity:1; transform:none; }
    .question.correct{ border-color:#cbe6d0; box-shadow:0 0 0 3px #e7f6ea inset; }
    .question.wrong{ border-color:#f6c3c3; box-shadow:0 0 0 3px #fde8e8 inset; }

    .question p{ margin:0 0 10px; font-weight:700; }
    .question label{ display:block; margin:8px 0; padding:8px 10px; border-radius:10px; cursor:pointer; transition: background .2s, transform .05s; }
    .question input{ margin-right:8px; }
    .question label:hover{ background:#f4f4f6; transform: translateY(-1px); }

    .feedback{ margin-top:8px; font-weight:700; display:none; }
    .feedback.ok{ color:var(--ok); }
    .feedback.err{ color:var(--warn); }

    .nav{ display:flex; gap:10px; justify-content:flex-end; margin-top:8px; }
    .next{
      padding:10px 18px; font-size:.98rem; background:var(--brand); color:#fff; border:none; border-radius:10px;
      cursor:not-allowed; opacity:.6; transition:.2s;
    }
    .next.enabled{ cursor:pointer; opacity:1; }
    .next.enabled:hover{ background:var(--brand-dark); }

    #result{ margin-top:28px; font-size: clamp(1.1rem, .9rem + .8vw, 1.6rem); font-weight:800; display:none; color:var(--ok); }

    /* Confetti */
    #confettiCanvas{ position: fixed; inset:0; pointer-events:none; display:none; }

    footer{ margin-top:60px; color:#777; font-size:.9rem; }
    .badge{ display:inline-block; padding:6px 10px; border-radius:999px; background:#fff; border:1px solid #eee; color:#666; }

    /* GAME OVER */
    .overlay{
      position: fixed; inset:0; background: rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; z-index: 50;
    }
    .overlay .go-card{
      background:#fff; padding:28px 24px; border-radius:18px; text-align:center;
      box-shadow: 0 18px 40px rgba(0,0,0,.25); max-width: 420px;
    }
    .overlay h3{ margin:0 0 10px; font-size:1.8rem; color:#b4231e; }
    .overlay p{ margin:0 0 16px; color:#555; }
    .overlay .retry{ background:#fff; color:var(--brand); border:1px solid var(--brand); padding:10px 18px; border-radius:10px; cursor:pointer; }
    .overlay .retry:hover{ background:#fff3ef; }

    /* ===== SEZIONE REGALO ===== */
    #giftSection .card{
      max-width: 820px; margin: 0 auto; background:#fff; border:1px solid #0000000f; border-radius:20px; box-shadow: 0 10px 28px rgba(0,0,0,.08);
      padding: 22px;
    }
    #giftSection h1{
      font-size: clamp(1.8rem, 1.2rem + 2vw, 2.4rem); margin: 0 0 14px; color: var(--brand);
    }
    .gift-block{ margin: 18px auto 10px; }
    .gift-img{
      width: 100%; height: auto; display:block; border-radius:16px; object-fit:cover;
      box-shadow: 0 8px 20px rgba(0,0,0,.12);
    }
    .caption{
      margin-top:10px; font-weight:700; color:#333;
    }
    .subcaption{
      margin-top:4px; color:#666;
    }

    .btn-row{ margin-top:18px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
    .secondary{ background:#fff; color:var(--brand); border:1px solid var(--brand); border-radius:12px; padding:10px 16px; cursor:pointer; }
    .secondary:hover{ background:#fff3ef; }
	/* Countdown sul blocco foto di Roma */
.gift-block{ position: relative; }  /* rende possibile il posizionamento assoluto */
.countdown{
  position:absolute; top:10px; right:10px;
  background: rgba(0,0,0,.65);
  color:#fff; font-weight:700; font-size:.95rem;
  padding:8px 12px; border-radius:12px;
  backdrop-filter: blur(2px);
  box-shadow: 0 6px 16px rgba(0,0,0,.2);
}
@media (max-width: 520px){
  .countdown{ font-size:.9rem; padding:6px 10px; }
}
@media (max-width: 520px){
  .countdown{ font-size:.9rem; padding:6px 10px; }
}

/* --- Animazioni sezione finale --- */
#finalSection .step { 
  opacity:0; 
  transform: translateY(8px); 
  transition: opacity .5s ease, transform .5s ease; 
}
#finalSection .step.in { 
  opacity:1; 
  transform:none; 
}

#finalSection .title-step { transition-delay: .05s; }
#finalSection .body-step  { transition-delay: .45s; } /* il corpo entra dopo il titolo */
/* --- Reveal regalo + aereo --- */
#giftSection .reveal{
  opacity:0;
  transform: translateY(12px);
  filter: blur(6px);
  transition: opacity .9s ease, transform .9s ease, filter .9s ease;
}
#giftSection .reveal.in{
  opacity:1;
  transform:none;
  filter: blur(0);
}

/* effetto extra sulle immagini quando entrano */
#giftSection .reveal.in .gift-img{
  transition: transform 1s ease;
  transform: scale(1.02);
}

/* Aereo in volo con immagine */
.plane{
  position: fixed;
  left: -260px;        
  top: 18vh;           
  width: 260px;        
  height: 140px;
  background: url("aereo.png") center center / contain no-repeat;
  z-index: 60;
  pointer-events: none;
  animation: planeFly 4000ms ease-in-out forwards; 
  filter: drop-shadow(0 6px 14px rgba(0,0,0,.35));
}

/* scia dell‚Äôaereo (rimane sul contenitore .plane) */
.plane::after{
  content:"";
  position:absolute;
  left:-280px; top:50%;
  width:280px; height:3px;
  background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.85), rgba(255,255,255,0));
  transform: translateY(-50%);
  filter: blur(2px);
  opacity:.85;
}

/* traiettoria */
@keyframes planeFly{
  0%   { transform: translateX(0) rotate(5deg); }
  35%  { top: 16vh; }
  65%  { top: 19vh; }
  100% { transform: translateX(calc(100vw + 420px)) rotate(-6deg); }
}


  </style>
</head>
<body>
  <canvas id="confettiCanvas"></canvas>

  <!-- GAME OVER -->
  <div class="overlay" id="gameOver">
    <div class="go-card">
      <h3>GAME OVER</h3>
      <p>Hai sbagliato una risposta. Si riparte da zero!</p>
      <button class="retry" id="retryBtn">Riprova</button>
    </div>
  </div>

  <!-- INTRO -->
  <header>
    <div class="wrap">
      <div class="hero">üéÅ Il tuo regalo sta qua dentro! üéÅ</div>
      <button class="cta" id="btnStart" aria-controls="quizSection" aria-expanded="false">Gioca</button>
    </div>
  </header>

  <!-- QUIZ -->
  <section id="quizSection" aria-hidden="true">
    <!-- Progress -->
    <div class="progress-wrap">
      <div class="progress-label"><span id="progressText">0/5</span> verso il traguardo</div>
      <div class="progress" aria-label="Progresso quiz">
        <div class="bar" id="bar"></div>
        <div class="gift" aria-hidden="true">üéÅ</div>
      </div>
    </div>

    <h2>Rispondi alle domande‚Ä¶ una per volta üòâ</h2>
    <div class="subtitle">Solo se indovini, passi alla successiva!</div>

    <form id="quizForm" class="quiz">

  <!-- 1: fidanzamento -->
  <div class="question active" data-name="q2">
    <p>1) Che giorno ci siamo fidanzati?</p>
    <label><input type="radio" name="q2" value="14/02/2023"> 14/02/2023</label>
<label><input type="radio" name="q2" value="01/01/2023"> 01/01/2023</label>
<label><input type="radio" name="q2" value="20/05/2023"> 20/05/2023</label> <!-- CORRETTA -->
<label><input type="radio" name="q2" value="31/12/2023"> 31/12/2023</label>

    <div class="feedback err">Quasi! Prova a ricordare meglio üíò</div>
    <div class="feedback ok">S√¨! Quel giorno speciale ‚ù§Ô∏è</div>
    <div class="nav"><button type="button" class="next" disabled>Avanti ‚Üí</button></div>
  </div>

  <!-- 2: conosciuti -->
  <div class="question" data-name="q4">
    <p>2) Dove ci siamo conosciuti?</p>
    <label><input type="radio" name="q4" value="a scuola"> A scuola</label>
<label><input type="radio" name="q4" value="in palestra"> In palestra</label> <!-- CORRETTA -->
<label><input type="radio" name="q4" value="in spiaggia"> In spiaggia</label>
<label><input type="radio" name="q4" value="al lavoro"> Al lavoro</label>

    <div class="feedback err">Mmm, non proprio‚Ä¶ üí≠</div>
    <div class="feedback ok">Giusto! üí™</div>
    <div class="nav"><button type="button" class="next" disabled>Avanti ‚Üí</button></div>
  </div>

  <!-- 3: squadra -->
  <div class="question" data-name="q1">
    <p>3) Quale squadra tifo?</p>
    <label><input type="radio" name="q1" value="Juventus"> Juventus</label>
<label><input type="radio" name="q1" value="Milan"> Milan</label>
<label><input type="radio" name="q1" value="Inter"> Inter</label>
<label><input type="radio" name="q1" value="Napoli"> Napoli</label> <!-- CORRETTA -->

    <div class="feedback err">Non ti permettere üòÖ</div>
    <div class="feedback ok">Bravissima/o! ‚úÖ</div>
    <div class="nav"><button type="button" class="next" disabled>Avanti ‚Üí</button></div>
  </div>

  <!-- 4: compleanno -->
  <div class="question" data-name="q5">
    <p>4) Che giorno sono nato?</p>
    <label><input type="radio" name="q5" value="02 09 2006"> 02 09 2006</label>
<label><input type="radio" name="q5" value="09 02 2006"> 09 02 2006</label> <!-- CORRETTA -->
<label><input type="radio" name="q5" value="19 02 2006"> 19 02 2006</label>
<label><input type="radio" name="q5" value="09 12 2006"> 09 12 2006</label>

    <div class="feedback err">Attenzione al giorno e al mese! üéÇ</div>
    <div class="feedback ok">Tombola! ü•≥</div>
    <div class="hint">Formato: <span class="badge">gg mm aaaa</span></div>
    <div class="nav"><button type="button" class="next" disabled>Avanti ‚Üí</button></div>
  </div>

  <!-- 5: uscita prima volta -->
  <div class="question" data-name="q3">
    <p>5) Dove siamo usciti la prima volta?</p>
    <label><input type="radio" name="q3" value="Vomero"> Vomero</label> <!-- CORRETTA -->
<label><input type="radio" name="q3" value="Posillipo"> Posillipo</label>
<label><input type="radio" name="q3" value="Chiaia"> Chiaia</label>
<label><input type="radio" name="q3" value="Centro Storico"> Centro Storico</label>

    <div class="feedback err">Nope, non era l√¨ üòÑ</div>
    <div class="feedback ok">Esatto! Che ricordi ‚ú®</div>
    <div class="nav"><button type="button" class="next" disabled>Mostra il regalo üéÅ</button></div>
  </div>

</form>


    <!-- Messaggio (non pi√π usato come finale, ma lo lasciamo se vuoi un preavviso) -->
    <div id="result" aria-live="polite"></div>

    <footer>
      <p style="margin-top:26px;">Questo link √® privato: condividilo solo con chi vuoi tu.</p>
    </footer>
  </section>
  <!-- ===== SCHERMATA DOMANDA FINALE ===== -->
<section id="finalSection" aria-hidden="true">
  <div class="card" style="max-width:740px;margin:0 auto;background:#fff;border:1px solid #0000000f;border-radius:20px;box-shadow:0 10px 28px rgba(0,0,0,.08);padding:22px;">
    
    <!-- TITOLO: entra per primo -->
    <div id="finalTitle" class="step title-step">
      <h2 style="margin-top:0">Per sbloccare il tuo regalo c'√® un‚Äôultima domanda</h2>
    </div>

    <!-- CORPO: entra dopo -->
    <div id="finalBody" class="step body-step">
      <p class="subtitle">Qual √® stato il primo messaggio che ti ho mandato?</p>

      <input type="text" id="openAnswer" placeholder="Scrivi qui la risposta..." 
             style="width:100%;padding:12px 14px;border-radius:12px;border:1px solid #ddd;font-size:1rem;">

      <div id="finalFeedback" class="feedback" style="display:block;margin-top:10px;color:#777;">
        Suggerimento: rispetta gli spazi üòâ
      </div>

      <div class="btn-row" style="margin-top:16px;">
        <button class="secondary" id="unlockBtn">Mostra il regalo üéÅ</button>
      </div>
    </div>

  </div>
</section>



  <!-- ===== SCHERMATA REGALO ===== -->
 <section id="giftSection" aria-hidden="true">
  <div class="card">
    <h1 class="reveal">‚ú® Il tuo regalo √®‚Ä¶ ‚ú®</h1>

    <div class="gift-block reveal">
      <div class="countdown" id="countdown">Mancano ‚Äî giorni</div>
      <img class="gift-img" src="ROMA.JPG" alt="Roma - Colosseo" />
      <div class="caption">Viaggeremo a Roma il <strong>06-12</strong></div>
    </div>

    <div class="gift-block reveal" style="margin-top:22px;">
      <div class="caption" style="margin-bottom:10px;">Alloggeremo</div>
      <a href="https://www.lhgcomfyrooms.com/" target="_blank">
        <img class="gift-img" src="STANZA.jpeg" alt="LHG Comfy Rooms - camera" />
      </a>
      <div class="subcaption"><strong>LHG Comfy Rooms.</strong></div>
    </div>

    <div class="btn-row reveal">
      <button class="secondary" id="backToStart">Torna all‚Äôinizio</button>
    </div>
  </div>
</section>


  <script>
    /* ====== Mostra quiz dopo "Gioca" ====== */
    const btnStart = document.getElementById('btnStart');
    const quizSection = document.getElementById('quizSection');
    const giftSection = document.getElementById('giftSection');
    btnStart.addEventListener('click', () => {
      quizSection.classList.add('show');
      quizSection.setAttribute('aria-hidden','false');
      btnStart.setAttribute('aria-expanded','true');
      quizSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    // ===== Progress =====
    const bar = document.getElementById('bar');
    const progressText = document.getElementById('progressText');
    const totalQuestions = 5;
    let currentStep = 0; // 0..5
    function updateProgress(step){
      currentStep = step;
      const pct = Math.max(0, Math.min(100, (step/totalQuestions)*100));
      bar.style.width = pct + '%';
      progressText.textContent = `${step}/${totalQuestions}`;
    }
    updateProgress(0);

    // ===== Answers & quiz logic =====
    const answers = {
      q1: "Napoli",
      q2: "20/05/2023",
      q3: "Vomero",
      q4: "in palestra",
      q5: "09 02 2006"
    };

    const form = document.getElementById('quizForm');
    const questions = [...form.querySelectorAll('.question')];
    const resultEl = document.getElementById('result');

    // GAME OVER overlay
    const overlay = document.getElementById('gameOver');
    const retryBtn = document.getElementById('retryBtn');
    function showGameOver(){ overlay.style.display = 'flex'; }
    function hideGameOver(){ overlay.style.display = 'none'; }

    function resetGame(){
      form.reset();
      questions.forEach(q=>{
        q.classList.remove('correct','wrong','active');
        q.querySelectorAll('.feedback').forEach(f=>f.style.display='none');
        const nb = q.querySelector('.next');
        nb.disabled = true;
        nb.classList.remove('enabled');
      });
      questions[0].classList.add('active');
      resultEl.style.display = 'none';
      updateProgress(0);
      // torna alla sezione quiz se eri sul regalo
      giftSection.classList.remove('show');
      quizSection.classList.add('show');
      quizSection.scrollIntoView({behavior:'smooth', block:'start'});
    }
    retryBtn.addEventListener('click', ()=>{ hideGameOver(); resetGame(); });

    // Feedback immediato + progress + blocco su errore
    questions.forEach((qEl, idx) => {
      const name = qEl.dataset.name;
      const okBox = qEl.querySelector('.feedback.ok');
      const errBox = qEl.querySelector('.feedback.err');
      const nextBtn = qEl.querySelector('.next');

      qEl.querySelectorAll('input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', () => {
          const correct = radio.value === answers[name];
          okBox.style.display = 'none';
          errBox.style.display = 'none';
          qEl.classList.remove('correct','wrong');

          if (correct) {
            okBox.style.display = 'block';
            qEl.classList.add('correct');
            nextBtn.disabled = false;
            nextBtn.classList.add('enabled');
            updateProgress(idx + 1);
            nextBtn.focus();
          } else {
            errBox.style.display = 'block';
            qEl.classList.add('wrong');
            nextBtn.disabled = true;
            nextBtn.classList.remove('enabled');
            updateProgress(0);
            setTimeout(showGameOver, 250);
          }
        });
      });


      nextBtn.addEventListener('click', () => {
        if (nextBtn.disabled) return;
        qEl.classList.remove('active');
        if (idx < questions.length - 1) {
          const nextQ = questions[idx + 1];
          nextQ.classList.add('active');
          nextQ.scrollIntoView({ behavior: 'smooth', block: 'start' });
          const p = nextQ.querySelector('p');
          if (p) p.setAttribute('tabindex','-1'), p.focus();
       } else {
  // Fine -> vai alla schermata DOMANDA FINALE
  updateProgress(totalQuestions);
showFinalScreen();
}
      });
    });

	// === Countdown al 06/12/2025 (formato: 6 dicembre 2025) ===
const countdownEl = document.getElementById('countdown');

// calcolo differenza in giorni ignorando l'ora locale
function daysBetweenUTC(fromDate, toDate){
  const msPerDay = 24*60*60*1000;
  const utcFrom = Date.UTC(fromDate.getFullYear(), fromDate.getMonth(), fromDate.getDate());
  const utcTo   = Date.UTC(toDate.getFullYear(),   toDate.getMonth(),   toDate.getDate());
  return Math.ceil((utcTo - utcFrom) / msPerDay);
}

function updateCountdown(){
  const today = new Date();
  const target = new Date(Date.UTC(2025, 11, 6)); // 11 = dicembre (mesi 0-11)
  const d = daysBetweenUTC(today, target);

  if (!countdownEl) return;
  countdownEl.textContent =
    d > 0 ? `Mancano ${d} ${d===1 ? "giorno" : "giorni"}`
      : d === 0 ? "√à oggi! üéâ"
      : "Siamo gi√† stati! ‚ù§Ô∏è";
}

let countdownTimer;
function startCountdown(){
  updateCountdown();
  clearInterval(countdownTimer);
  // aggiorniamo ogni ora (basta per i giorni)
  countdownTimer = setInterval(updateCountdown, 60*60*1000);
}


function showGiftScreen(){
  // mostra il contenitore del regalo
  quizSection.classList.remove('show');
  giftSection.classList.add('show');
  giftSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

  // reset reveal (se si rigioca)
  const items = [...giftSection.querySelectorAll('.reveal')];
  items.forEach(el => el.classList.remove('in'));

  // crea l‚Äôaereo (usa il CSS con background)
  const plane = document.createElement('div');
  plane.className = 'plane';
  plane.setAttribute('aria-hidden','true');
  document.body.appendChild(plane);

  // rivelazione a cascata mentre l‚Äôaereo passa
  // parte dopo un attimo, poi uno ogni 400ms
  items.forEach((el, i) => {
    setTimeout(() => el.classList.add('in'), 900 + i * 400);
  });

  // a fine volo: rimuovi aereo, coriandoli e countdown
  plane.addEventListener('animationend', () => {
    plane.remove();
    launchConfetti(160);
    startCountdown();
  }, { once: true });

  // nascondi eventuale messaggio precedente
  const resultEl = document.getElementById('result');
  if (resultEl) resultEl.style.display = 'none';
}

function showFinalScreen(){
  const finalSection = document.getElementById('finalSection');
  const finalTitle   = document.getElementById('finalTitle');
  const finalBody    = document.getElementById('finalBody');

  finalTitle.classList.remove('in');
  finalBody.classList.remove('in');

  document.getElementById('quizSection').classList.remove('show');
  finalSection.classList.add('show');
  finalSection.scrollIntoView({ behavior:'smooth', block:'start' });

  requestAnimationFrame(()=> {
    finalTitle.classList.add('in');
    setTimeout(()=> finalBody.classList.add('in'), 250);
  });
}

// ===== DOMANDA FINALE (aperta) ‚Äî VERSIONE ROBUSTA =====
(function setupFinalQuestion(){
  const finalSection = document.getElementById('finalSection');
  const openAnswer   = document.getElementById('openAnswer');
  const unlockBtn    = document.getElementById('unlockBtn');
  const finalFeedback= document.getElementById('finalFeedback');

  if (!finalSection || !openAnswer || !unlockBtn || !finalFeedback) return;

  // suggerimento live (non blocca il bottone)
  function checkAnswer(){
    const ok = openAnswer.value.trim().toLowerCase() === 'chi sono';
    finalFeedback.textContent = ok
      ? 'Perfetto! üéâ Ora puoi vedere il regalo.'
      : 'Scrivi la risposta corretta per sbloccarlo‚Ä¶';
    finalFeedback.style.color = ok ? 'var(--ok)' : '#777';
  }
  openAnswer.addEventListener('input', checkAnswer);

  // clic su "Mostra il regalo"
  unlockBtn.addEventListener('click', () => {
    const rispostaOK = openAnswer.value.trim().toLowerCase() === 'chi sono';

    if (!rispostaOK) {
      finalFeedback.textContent = "‚ùå Regalo ancora bloccato‚Ä¶ mettici pi√π impegno! üòâ";
      finalFeedback.style.color = "var(--warn)";
      // piccola vibrazione visiva del campo (opzionale)
      openAnswer.style.transition = 'transform .08s ease';
      openAnswer.style.transform = 'translateX(-3px)';
      setTimeout(()=> openAnswer.style.transform = 'translateX(3px)', 80);
      setTimeout(()=> openAnswer.style.transform = 'none', 160);
      openAnswer.focus();
      return;
    }

    // risposta corretta ‚Üí mostra il regalo
    finalSection.classList.remove('show');
    showGiftScreen();
  });
})();




    // Bottone "torna all‚Äôinizio"
    document.getElementById('backToStart').addEventListener('click', ()=>{
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    /* =============== Mini confetti =============== */
    const confettiCanvas = document.getElementById('confettiCanvas');
    const ctx = confettiCanvas.getContext('2d');
    let confettiPieces = [];
    let confettiActive = false;

    function resizeCanvas(){
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function launchConfetti(count=100){
      confettiActive = true;
      confettiCanvas.style.display = 'block';
      confettiPieces = [];
      for(let i=0;i<count;i++){
        confettiPieces.push({
          x: Math.random()*confettiCanvas.width,
          y: -20 - Math.random()*confettiCanvas.height*0.4,
          r: 4 + Math.random()*6,
          vx: -1 + Math.random()*2,
          vy: 2 + Math.random()*3,
          rot: Math.random()*360,
          vrot: -8 + Math.random()*16,
          color: `hsl(${Math.floor(Math.random()*360)}, 90%, 60%)`,
          shape: Math.random() < 0.5 ? 'circle' : 'rect'
        });
      }
      requestAnimationFrame(confettiLoop);
      setTimeout(()=>{ confettiActive=false; }, 4000);
      setTimeout(()=>{ confettiCanvas.style.display='none'; }, 5200);
    }

    function confettiLoop(){
      if(!confettiActive && confettiPieces.every(p=>p.y>confettiCanvas.height+30)) return;
      ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
      confettiPieces.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.rot += p.vrot;
        ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot * Math.PI/180);
        ctx.fillStyle = p.color;
        if(p.shape === 'circle'){ ctx.beginPath(); ctx.arc(0,0,p.r,0,Math.PI*2); ctx.fill(); }
        else{ ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2); }
        ctx.restore();
      });
      confettiPieces = confettiPieces.filter(p => p.y < confettiCanvas.height + 40);
      requestAnimationFrame(confettiLoop);
    }

    // Chiudi overlay clic fuori (opzionale)
overlay.addEventListener('click', (e)=>{
  if (e.target === overlay){ hideGameOver(); resetGame(); }
});

  </script>
</body>
</html>
